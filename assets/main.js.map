{"version":3,"file":"main.js","sources":["../src/utilities.js","../src/state.js","../src/templates.js","../src/render.js","../src/updateResults.js","../src/bind.js","../src/index.js"],"sourcesContent":["\nexport default class utilities {\n\n    static getEnvironmentType(hostname) {\n        switch (hostname) {\n            case 'localhost':\n            {\n                return `development`;\n            }\n            case '127.0.0.1':\n            {\n                return `development`;\n            }\n            default:\n            {\n                return `production`;\n            }\n        }\n    }\n\n    static getUrlParams() {\n        const queryString = location.search;\n        if (!queryString) {\n            return {};\n        }\n\n        let queries = queryString.split(/[\\&?]+/);\n        queries.splice(0, 1);\n\n        let returnValue = {};\n        queries.forEach(query => {\n            const splitQuery = query.split('=');\n            try {\n                splitQuery[1] = decodeURIComponent(splitQuery[1]);\n            } catch(e) {\n                console.error(e);\n            }\n\n            returnValue[splitQuery[0]] = splitQuery[1];\n        });\n\n        return returnValue;\n    }\n}\n","import utilities from './utilities';\n\nlet currentState = {\n    count: 0,\n    areaCount: 0,\n    query: utilities.getUrlParams().q || ``,\n    filter: {\n        id: utilities.getUrlParams().filter || ``,\n        name: utilities.getUrlParams().filter || ``\n    },\n    apiUrl: \"https://search.discovery.onsdigital.co.uk\"\n};\n\nexport default class state {\n\n    static getState() {\n        return JSON.parse(JSON.stringify(currentState));\n    }\n\n    static updateState(action) {\n        const newState = this.getState();\n        switch (action.type) {\n            case ('UPDATE_COUNT'): {\n                newState.count = action.value;\n                break;\n            }\n            case ('UPDATE_AREA_COUNT'): {\n                newState.areaCount = action.value;\n                break;\n            }\n            case ('UPDATE_QUERY'): {\n                newState.query = action.value;\n                break;\n            }\n            case ('UPDATE_FILTER'): {\n                newState.filter = action.value;\n                break;\n            }\n        }\n\n        currentState = newState;\n    }\n\n}\n","import state from './state';\n\nexport default class templates {\n\n    static searchText(children) {\n        const currentState = state.getState();\n        const query = currentState.query;\n        const count = currentState.count;\n        const filter = currentState.filter.id;\n        const filterName = currentState.filter.name;\n\n        function wrapInContainer(children) {\n            return (\n                `<div class=\"border-bottom--iron-md border-bottom--iron-lg\">\n                <h2 class=\"search-text margin-top--2 margin-bottom--2\">\n                    ${children}\n                </h2>\n            </div>`\n            )\n        }\n\n        if (children) {\n            return wrapInContainer(children)\n        }\n\n        if (query && count === 0) {\n            return wrapInContainer(`No results for <strong>'${currentState.query}'</strong>`);\n        }\n\n        if (!query) {\n            return wrapInContainer(`No search query, showing all <strong>'${count}'</strong> results`);\n        }\n\n        if (query && filter) {\n            return wrapInContainer(`<strong>${count}</strong> results found for <strong>'${query}'</strong>, filtered by area type <strong>'${filterName}'</strong>`)\n        }\n\n        return wrapInContainer(`<strong>${count}</strong> results found for <strong>'${query}'</strong>`);\n    }\n\n    static areaSearchText() {\n        const currentState = state.getState();\n        const query = currentState.query;\n        const count = currentState.areaCount;\n\n        function wrapInContainer(children) {\n            return (\n                `<div class=\"col\">\n                <h2 class=\"search-text margin-top--2 margin-bottom--2\">\n                    ${children}\n                </h2>\n            </div>`\n            )\n        }\n\n        return wrapInContainer(`\n        Showing the top <strong>${(count > 4) ? `4` : count}</strong> suggested location${count > 1 ? `s` : ``}${query ? ` for <strong>'${query}'</strong>` : ''}.\n        <a href=\"\">View all</a>\n    `)\n    }\n\n    static datasetResultItem(data) {\n        return (\n            `<div class=\"result border-bottom--iron-md border-bottom--iron-lg\">\n            <h3 class=\"result__title\"><a href=\"\">${data.title}</a></h3>\n            <div class=\"result__description\">${data.description}</div>\n            <span class=\"result__metadata\">${data.type}</span>\n            <span class=\"result__metadata\">Released on ${data.releaseDate}</span>\n        </div>`\n        );\n    }\n\n    static areaResultItem(data) {\n        return (\n            `<div class=\"col col--lg-half background--iron-light margin-bottom--2 padding-top--2 padding-right--1 padding-bottom--2 padding-left--1\">\n            <span class=\"baseline\">${data.type}</span>\n            <span class=\"icon icon-arrow-right--dark float-right margin-top--1\"></span>\n            <h3 class=\"flush\">\n                <a class=\"area-link\" href=\"/?q=${state.query}&filter=${data.type_id}\" data-filter=\"${data.type_id}\" data-filter-name=\"${data.type}\">\n                    ${data.title}\n                </a>\n            </h3>\n        </div>\n        `\n        );\n    }\n}\n","import state from './state';\nimport templates from './templates';\n\nconst appElem = document.getElementById('app');\nconst title = document.getElementById('title');\nconst typeahead = document.getElementById('typeahead');\n\nexport default class render {\n\n    static querySuggestions(suggestions) {\n        this.emptyQuerySuggestions();\n        typeahead.innerHTML = '<ul class=\"typeahead__list\"><li class=\"typeahead__item\">' + suggestions.join('</li><li class=\"typeahead__item\">') + '</li></ul>';\n        typeahead.style.display = 'block';\n    }\n\n    static emptyQuerySuggestions() {\n        while (typeahead.firstChild) typeahead.removeChild(typeahead.firstChild);\n    }\n\n    static emptyResults() {\n        while (appElem.firstChild) appElem.removeChild(appElem.firstChild);\n    }\n\n    static allResults(areaResults, datasetResults) {\n        this.areaResults(areaResults);\n        this.datasetResults(datasetResults)\n    }\n\n    static allResultsForAreaType(resultsData) {\n        const HTMLParts = [];\n        const currentState = state.getState();\n        const searchText = `All <strong>'${currentState.count}'</strong> results, filtered by <strong>'${currentState.query}'</strong> as a <strong>'${currentState.filter.name}'</strong>`;\n\n        function wrapInContainer(children) {\n            return (\n                `<div class=\"col margin-bottom--3\">\n                ${templates.searchText(searchText)}\n                ${children}\n            </div>`\n            );\n        }\n\n        resultsData.map(result => {\n            let date = result.body.metadata.release_date.split('+');\n\n            // Check for invalid date\n            if (date[1]) {\n                date.pop();\n                date.push('Z');\n                date = date.join('');\n            }\n\n            const data = {\n                title: result.body.title,\n                description: result.body.metadata.description,\n                type: result.type,\n                releaseDate: new Date(date).toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' })\n            };\n\n            HTMLParts.push(templates.datasetResultItem(data));\n        });\n\n        appElem.innerHTML += wrapInContainer(HTMLParts.join(''));\n    }\n\n    static datasetResults(resultsData) {\n        const HTMLParts = [];\n        const count = state.getState().count;\n\n        if (count === 0) {\n            return wrapInContainer(``);\n        }\n\n        function wrapInContainer(children) {\n            return (\n                `<div class=\"col margin-bottom--3\">\n                ${templates.searchText()}\n                ${children}\n            </div>`\n            );\n        }\n\n        resultsData.map(result => {\n            let date = result.body.metadata.release_date.split('+');\n\n            // Check for invalid date\n            if (date[1]) {\n                date.pop();\n                date.push('Z');\n                date = date.join('');\n            }\n\n            const data = {\n                title: result.body.title,\n                description: result.body.metadata.description,\n                type: result.type,\n                releaseDate: new Date(date).toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' })\n            };\n\n            HTMLParts.push(templates.datasetResultItem(data));\n        });\n\n        appElem.innerHTML += wrapInContainer(HTMLParts.join(''));\n    }\n\n    static areaResults(resultsData) {\n        const HTMLParts = [];\n        const currentState = state.getState();\n        const count = currentState.areaCount;\n        const query = currentState.query;\n\n        if (count === 0 || !query) {\n            return ``;\n        }\n\n        function wrapInContainer(children) {\n            return (\n                `<div style=\"width: 100%;\" class=\"float-left border-bottom--iron-md border-bottom--iron-lg padding-bottom--2\">\n                ${templates.areaSearchText()}\n                ${children}\n            </div>`\n            )\n        }\n\n        resultsData.some((result, index) => {\n            const data = {\n                title: result.body.title,\n                type: result.body.type,\n                type_id: result.body.type_id\n            };\n\n            HTMLParts.push(templates.areaResultItem(data));\n\n            return index === 3;\n        });\n\n        appElem.innerHTML += wrapInContainer(HTMLParts.join(''));\n    }\n\n    static error() {\n        appElem.innerHTML += `\n            <div class=\"col\">\n                <h2>Oops, there's been an error</h2>\n                <p class=\"margin-top--2 margin-bottom--0\">There was an issue getting your results.</p>\n                <p class=\"flush\">Please try again in a few moments.</p>\n            </div>\n        `\n    }\n\n    static title(query) {\n        if (query) {\n            title.innerHTML = query + ` - Search - Office for National Statistics`;\n        } else {\n            title.innerHTML = `Search - Office for National Statistics`;\n        }\n    }\n}\n","import render from './render';\nimport state from './state';\nimport bind from './bind';\n\nconst inputElem = document.getElementById('search__input');\n\nexport default function updateResults() {\n\n    const currentState = state.getState();\n\n    // Fetch polyfill\n    if (!window.fetch) {\n        console.log('Using Fetch API polyfill');\n        const js = document.createElement('script');\n        js.src = 'https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.2/fetch.min.js';\n        js.onload = function() {\n            updateResults();\n        };\n        js.onerror = function() {\n            console.log('Error getting fetch API polyfill');\n        };\n        document.head.appendChild(js);\n        return;\n    }\n\n    if (currentState.query !== inputElem.value) {\n        console.log('Fetching results for \"%s\"', currentState.query);\n        inputElem.value = currentState.query;\n    }\n\n    render.title(currentState.query);\n\n    fetch(currentState.apiUrl + `/search?q=` + currentState.query + '&filter=' + currentState.filter.id).then(response => response.json()).then(response => {\n        state.updateState({\n            type: 'UPDATE_COUNT',\n            value: response.total_results\n        });\n        state.updateState({\n            type: 'UPDATE_AREA_COUNT',\n            value: response.area_results ? response.area_results.length : 0\n        });\n\n        render.emptyResults();\n\n        if (state.getState().filter.id && state.getState().count === 0) {\n            console.log(`Display all results for ${state.getState().filter.name}`);\n            fetch(`${state.getState().apiUrl}/search?filter=${state.getState().filter.id}`).then(response => response.json()).then(response => {\n                state.updateState({\n                    type: 'UPDATE_COUNT',\n                    value: response.total_results\n                });\n                state.updateState({\n                    type: 'UPDATE_AREA_COUNT',\n                    value: response.area_results ? response.area_results.length : 0\n                });\n                render.allResultsForAreaType(response.results);\n                bind.areaClick();\n            });\n            return false;\n        }\n\n        if (state.getState().filter.id) {\n            render.datasetResults(response.results);\n            bind.areaClick();\n            return false;\n        }\n\n        render.allResults(response.area_results, response.results);\n        bind.areaClick();\n    }).catch(error => {\n        console.log(`Error getting results data \\n`, error);\n        render.emptyResults();\n        render.error();\n    });\n}\n","import state from './state';\nimport updateResults from './updateResults';\nimport render from './render';\n\nconst inputElem = document.getElementById('search__input');\nconst searchElem = document.getElementById('search');\nconst typeahead = document.getElementById('typeahead');\n\nexport default class bind {\n\n    static areaClick() {\n\n        const areaLinks = document.querySelectorAll('.area-link');\n\n        areaLinks.forEach(link => {\n            link.addEventListener('click', event => {\n                handleClick(event);\n            });\n        });\n\n        function handleClick(event) {\n            event.preventDefault();\n            state.updateState({\n                type: 'UPDATE_FILTER',\n                value: {\n                    id: event.target.getAttribute('data-filter'),\n                    name: event.target.getAttribute('data-filter-name')\n                }\n            });\n            const currentState = state.getState();\n            window.history.pushState(state.getState(), ``, `?q=${currentState.query}&filter=${currentState.filter.id}`);\n            updateResults();\n        }\n    }\n\n    static typeaheadKeys() {\n        searchElem.addEventListener('keydown', (event) => {\n            const keyCode = event.keyCode;\n            const upKey = 38;\n            const downKey = 40;\n            const escKey = 27;\n\n            if (keyCode !== upKey && keyCode !== downKey && keyCode !== escKey) {\n                return;\n            }\n\n            event.preventDefault();\n\n            if (keyCode === escKey && typeahead.childNodes.length !== 0) {\n                console.log('Close suggestions');\n                typeahead.style.display = 'none';\n                render.emptyQuerySuggestions();\n                return;\n            }\n\n            const suggestions = document.querySelectorAll('.typeahead__item');\n            let focusIndex = (getFocusIndex(suggestions) !== undefined) ? getFocusIndex(suggestions) : -1;\n\n            if (keyCode === downKey && focusIndex === -1 && typeahead.childNodes.length === 0) {\n                //TODO get suggestions on down arrow here\n                console.log('Get suggestions');\n            }\n\n            // Don't do anything for upkey if we're focused on the input\n            if (focusIndex === -1 && keyCode === upKey) {\n                return;\n            }\n\n            // Stop focus from attempting to go more than size of suggestions\n            if (focusIndex >= suggestions.length-1 && keyCode === downKey) {\n                return false;\n            }\n\n            // Stop focus trying to go to negative numbers\n            if (focusIndex === 0 && keyCode === upKey) {\n                console.log('First entry');\n                return false;\n            }\n\n            // Remove class from focused suggestion\n            if (focusIndex !== -1) {\n                suggestions[focusIndex].classList.remove('focused');\n            }\n\n            // Edit focus index according to direction of arrow keys\n            if (keyCode === downKey) {\n                focusIndex++;\n            }\n            if (keyCode === upKey) {\n                focusIndex--;\n            }\n\n            // Make sure next suggestion is in view, if not scroll into view\n            const suggestionRect = suggestions[focusIndex].getBoundingClientRect();\n            const containerRect = typeahead.getBoundingClientRect();\n            const bottomDiff = suggestionRect.bottom - containerRect.bottom;\n            const topDiff = suggestionRect.top - containerRect.top;\n            if (bottomDiff > 0) {\n                typeahead.scrollTop = typeahead.scrollTop + bottomDiff;\n            }\n            if (topDiff < 0) {\n                typeahead.scrollTop = typeahead.scrollTop + topDiff;\n            }\n\n            // Add focus class to next suggestion and update input value\n            suggestions[focusIndex].classList.add('focused');\n            inputElem.value = suggestions[focusIndex].textContent;\n        });\n\n        function getFocusIndex(suggestions) {\n            let response;\n            suggestions.forEach((suggestion, index) => {\n                if (suggestion.classList.contains('focused')) {\n                    response = index;\n                }\n            });\n            return response;\n        }\n    }\n\n    static searchFocus() {\n        searchElem.addEventListener('focusout', () => {\n            typeahead.style.display = 'none';\n            render.emptyQuerySuggestions();\n        });\n    }\n\n    static searchSubmit() {\n\n        searchElem.addEventListener('submit', event => {\n            const query = inputElem.value;\n            event.preventDefault();\n            state.updateState({\n                type: 'UPDATE_QUERY',\n                value: query\n            });\n            state.updateState({\n                type: 'UPDATE_FILTER',\n                value: {id: \"\", name: \"\"}\n            });\n\n            if (!query) {\n                window.history.pushState(state.getState(), ``, location.pathname);\n                updateResults();\n                return;\n            }\n\n            window.history.pushState(state.getState(), ``, `?q=${query}`);\n            updateResults();\n        });\n    }\n\n    static searchChange() {\n        let inputTimer;\n\n        inputElem.addEventListener('input', event => {\n            const inputValue = event.target.value;\n\n            clearTimeout(inputTimer);\n            inputTimer = setTimeout(() => {\n                fetch(`${state.getState().apiUrl}/suggest?q=${inputValue}`).then(response => response.json()).then(response => {\n                    if (response.total_results === 0) {\n                        return;\n                    }\n                    const suggestions = response.results.map(result => {\n                        return result.body.title;\n                    });\n                    render.querySuggestions(suggestions);\n                });\n            }, 100)\n        })\n    }\n\n    static historyState() {\n        window.onpopstate = event => {\n            state.updateState({\n                type: 'UPDATE_QUERY',\n                value: event.state.query\n            });\n            state.updateState({\n                type: 'UPDATE_FILTER',\n                value: event.state.filter\n            });\n            state.updateState({\n                type: 'UPDATE_COUNT',\n                value: event.state.count\n            });\n            state.updateState({\n                type: 'UPDATE_AREA_COUNT',\n                value: event.state.areaCount\n            });\n            updateResults();\n        }\n    }\n}\n","/* Imports */\nimport bind from './bind';\nimport updateResults from './updateResults'\n\n/* Initialise application */\nfunction init() {\n    updateResults();\n    bind.typeaheadKeys();\n    bind.searchFocus();\n    bind.searchChange();\n    bind.searchSubmit();\n    bind.historyState();\n}\n\ninit();\n"],"names":["utilities","hostname","queryString","location","search","queries","split","splice","returnValue","forEach","splitQuery","query","decodeURIComponent","e","error","currentState","getUrlParams","q","filter","state","JSON","parse","stringify","action","newState","getState","type","count","value","areaCount","templates","children","id","filterName","name","wrapInContainer","data","title","description","releaseDate","type_id","appElem","document","getElementById","typeahead","render","suggestions","emptyQuerySuggestions","innerHTML","join","style","display","firstChild","removeChild","areaResults","datasetResults","resultsData","HTMLParts","searchText","map","date","result","body","metadata","release_date","pop","push","Date","toLocaleDateString","day","month","year","datasetResultItem","areaSearchText","some","index","areaResultItem","inputElem","updateResults","window","fetch","log","js","createElement","src","onload","onerror","head","appendChild","apiUrl","then","response","json","updateState","total_results","area_results","length","emptyResults","allResultsForAreaType","results","areaClick","allResults","catch","searchElem","bind","areaLinks","querySelectorAll","addEventListener","event","handleClick","preventDefault","target","getAttribute","history","pushState","keyCode","upKey","downKey","escKey","childNodes","focusIndex","getFocusIndex","undefined","classList","remove","suggestionRect","getBoundingClientRect","containerRect","bottomDiff","bottom","topDiff","top","scrollTop","add","textContent","suggestion","contains","pathname","inputTimer","inputValue","setTimeout","querySuggestions","onpopstate","init","typeaheadKeys","searchFocus","searchChange","searchSubmit","historyState"],"mappings":"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"}