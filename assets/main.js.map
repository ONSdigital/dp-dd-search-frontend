{"version":3,"file":"main.js","sources":["../src/utilities.js","../src/state.js","../src/templates.js","../src/render.js","../src/updateResults.js","../src/bind.js","../src/index.js"],"sourcesContent":["\nexport default class utilities {\n\n    static getEnvironmentType(hostname) {\n        switch (hostname) {\n            case 'localhost':\n            {\n                return `development`;\n            }\n            case '127.0.0.1':\n            {\n                return `development`;\n            }\n            default:\n            {\n                return `production`;\n            }\n        }\n    }\n\n    static getUrlParams() {\n        const queryString = location.search;\n        if (!queryString) {\n            return {};\n        }\n\n        let queries = queryString.split(/[\\&?]+/);\n        queries.splice(0, 1);\n\n        let returnValue = {};\n        queries.forEach(query => {\n            const splitQuery = query.split('=');\n            try {\n                splitQuery[1] = decodeURIComponent(splitQuery[1]);\n            } catch(e) {\n                console.error(e);\n            }\n\n            returnValue[splitQuery[0]] = splitQuery[1];\n        });\n\n        return returnValue;\n    }\n}\n","import utilities from './utilities';\n\nlet currentState = {\n    count: 0,\n    areaCount: 0,\n    query: utilities.getUrlParams().q || ``,\n    filter: {\n        id: utilities.getUrlParams().filter || ``,\n        name: utilities.getUrlParams().filter || ``\n    },\n    apiUrl: \"https://search.discovery.onsdigital.co.uk\"\n};\n\nexport default class state {\n\n    static getState() {\n        return JSON.parse(JSON.stringify(currentState));\n    }\n\n    static updateState(action) {\n        const newState = this.getState();\n        console.log(`State update: \\n`, action);\n        switch (action.type) {\n            case ('UPDATE_COUNT'): {\n                newState.count = action.value;\n                break;\n            }\n            case ('UPDATE_AREA_COUNT'): {\n                newState.areaCount = action.value;\n                break;\n            }\n            case ('UPDATE_QUERY'): {\n                newState.query = action.value;\n                break;\n            }\n            case ('UPDATE_FILTER'): {\n                newState.filter = action.value;\n                break;\n            }\n        }\n\n        currentState = newState;\n    }\n\n}\n","import state from './state';\n\nexport default class templates {\n\n    static searchText(children) {\n        const currentState = state.getState();\n        const query = currentState.query;\n        const count = currentState.count;\n        const filter = currentState.filter.id;\n        const filterName = currentState.filter.name;\n\n        function wrapInContainer(children) {\n            return (\n                `<div class=\"border-bottom--iron-md border-bottom--iron-lg\">\n                <h2 class=\"search-text margin-top--2 margin-bottom--2\">\n                    ${children}\n                </h2>\n            </div>`\n            )\n        }\n\n        if (children) {\n            return wrapInContainer(children)\n        }\n\n        if (query && count === 0) {\n            return wrapInContainer(`No results for <strong>'${currentState.query}'</strong>`);\n        }\n\n        if (!query) {\n            return wrapInContainer(`No search query, showing all <strong>'${count}'</strong> results`);\n        }\n\n        if (query && filter) {\n            return wrapInContainer(`<strong>${count}</strong> results found for <strong>'${query}'</strong>, filter by area type <strong>'${filterName}'</strong>`)\n        }\n\n        return wrapInContainer(`<strong>${count}</strong> results found for <strong>'${query}'</strong>`);\n    }\n\n    static areaSearchText() {\n        const currentState = state.getState();\n        const query = currentState.query;\n        const count = currentState.areaCount;\n\n        function wrapInContainer(children) {\n            return (\n                `<div class=\"col\">\n                <h2 class=\"search-text margin-top--2 margin-bottom--2\">\n                    ${children}\n                </h2>\n            </div>`\n            )\n        }\n\n        return wrapInContainer(`\n        Showing the top <strong>${(count > 4) ? `4` : count}</strong> suggested location${count > 1 ? `s` : ``}${query ? ` for <strong>'${query}'</strong>` : ''}.\n        <a href=\"\">View all</a>\n    `)\n    }\n\n    static datasetResultItem(data) {\n        return (\n            `<div class=\"result border-bottom--iron-md border-bottom--iron-lg\">\n            <h3 class=\"result__title\"><a href=\"\">${data.title}</a></h3>\n            <div class=\"result__description\">${data.description}</div>\n            <span class=\"result__metadata\">${data.type}</span>\n            <span class=\"result__metadata\">Released on ${data.releaseDate}</span>\n        </div>`\n        );\n    }\n\n    static areaResultItem(data) {\n        return (\n            `<div class=\"col col--lg-half background--iron-light margin-bottom--2 padding-top--2 padding-right--1 padding-bottom--2 padding-left--1\">\n            <span class=\"baseline\">${data.type}</span>\n            <span class=\"icon icon-arrow-right--dark float-right margin-top--1\"></span>\n            <h3 class=\"flush\">\n                <a class=\"area-link\" href=\"/?q=${state.query}&filter=${data.type_id}\" data-filter=\"${data.type_id}\" data-filter-name=\"${data.type}\">\n                    ${data.title}\n                </a>\n            </h3>\n        </div>\n        `\n        );\n    }\n}\n","import state from './state';\nimport templates from './templates';\nimport bind from './bind';\n\nconst appElem = document.getElementById('app');\nconst title = document.getElementById('title');\nconst typeahead = document.getElementById('typeahead');\n\nexport default class render {\n\n    static querySuggestions(suggestions) {\n        this.emptyQuerySuggestions();\n        typeahead.innerHTML = '<ul class=\"typeahead__list\"><li class=\"typeahead__item\">' + suggestions.join('</li><li class=\"typeahead__item\">') + '</li></ul>';\n        typeahead.style.display = 'block';\n        bind.typeaheadArrowKeys();\n    }\n\n    static emptyQuerySuggestions() {\n        while (typeahead.firstChild) typeahead.removeChild(typeahead.firstChild);\n    }\n\n    static emptyResults() {\n        while (appElem.firstChild) appElem.removeChild(appElem.firstChild);\n    }\n\n    static allResults(areaResults, datasetResults) {\n        appElem.innerHTML += (this.areaResults(areaResults) + this.datasetResults(datasetResults));\n    }\n\n    static allResultsForAreaType(resultsData) {\n        const HTMLParts = [];\n        const currentState = state.getState();\n        const searchText = `All <strong>'${currentState.count}'</strong> results, filtered by area type <strong>'${currentState.filter.name}'</strong>`;\n\n        function wrapInContainer(children) {\n            return (\n                `<div class=\"col margin-bottom--3\">\n                ${templates.searchText(searchText)}\n                ${children}\n            </div>`\n            );\n        }\n\n        resultsData.map(result => {\n            let date = result.body.metadata.release_date.split('+');\n\n            // Check for invalid date\n            if (date[1]) {\n                date.pop();\n                date.push('Z');\n                date = date.join('');\n            }\n\n            const data = {\n                title: result.body.title,\n                description: result.body.metadata.description,\n                type: result.type,\n                releaseDate: new Date(date).toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' })\n            };\n\n            HTMLParts.push(templates.datasetResultItem(data));\n        });\n\n        appElem.innerHTML += wrapInContainer(HTMLParts.join(''));\n    }\n\n    static datasetResults(resultsData) {\n        const HTMLParts = [];\n        const count = state.getState().count;\n\n        if (count === 0) {\n            return wrapInContainer(``);\n        }\n\n        function wrapInContainer(children) {\n            return (\n                `<div class=\"col margin-bottom--3\">\n                ${templates.searchText()}\n                ${children}\n            </div>`\n            );\n        }\n\n        resultsData.map(result => {\n            let date = result.body.metadata.release_date.split('+');\n\n            // Check for invalid date\n            if (date[1]) {\n                date.pop();\n                date.push('Z');\n                date = date.join('');\n            }\n\n            const data = {\n                title: result.body.title,\n                description: result.body.metadata.description,\n                type: result.type,\n                releaseDate: new Date(date).toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' })\n            };\n\n            HTMLParts.push(templates.datasetResultItem(data));\n        });\n\n        return wrapInContainer(HTMLParts.join(''));\n    }\n\n    static areaResults(resultsData) {\n        const HTMLParts = [];\n        const currentState = state.getState();\n        const count = currentState.areaCount;\n        const query = currentState.query;\n\n        if (count === 0 || !query) {\n            return ``;\n        }\n\n        function wrapInContainer(children) {\n            return (\n                `<div style=\"width: 100%;\" class=\"float-left border-bottom--iron-md border-bottom--iron-lg padding-bottom--2\">\n                ${templates.areaSearchText()}\n                ${children}\n            </div>`\n            )\n        }\n\n        resultsData.some((result, index) => {\n            const data = {\n                title: result.body.title,\n                type: result.body.type,\n                type_id: result.body.type_id\n            };\n\n            HTMLParts.push(templates.areaResultItem(data));\n\n            return index === 3;\n        });\n\n        return wrapInContainer(HTMLParts.join(''));\n    }\n\n    static error() {\n        appElem.innerHTML += `\n            <div class=\"col\">\n                <h2>Oops, there's been an error</h2>\n                <p class=\"margin-top--2 margin-bottom--0\">There was an issue getting your results.</p>\n                <p class=\"flush\">Please try again in a few moments.</p>\n            </div>\n        `\n    }\n\n    static title(query) {\n        if (query) {\n            title.innerHTML = query + ` - Search - Office for National Statistics`;\n        } else {\n            title.innerHTML = `Search - Office for National Statistics`;\n        }\n    }\n}\n","import render from './render';\nimport state from './state';\nimport bind from './bind';\n\nconst inputElem = document.getElementById('search__input');\n\nexport default function updateResults() {\n\n    const currentState = state.getState();\n\n    // Fetch polyfill\n    if (!window.fetch) {\n        console.log('Using Fetch API polyfill');\n        const js = document.createElement('script');\n        js.src = 'https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.2/fetch.min.js';\n        js.onload = function() {\n            updateResults();\n        };\n        js.onerror = function() {\n            console.log('Error getting fetch API polyfill');\n        };\n        document.head.appendChild(js);\n        return;\n    }\n\n    if (currentState.query !== inputElem.value) {\n        console.log('Fetching results for \"%s\"', currentState.query);\n        inputElem.value = currentState.query;\n    }\n\n    render.title(currentState.query);\n\n    fetch(currentState.apiUrl + `/search?q=` + currentState.query + '&filter=' + currentState.filter.id).then(response => response.json()).then(response => {\n        state.updateState({\n            type: 'UPDATE_COUNT',\n            value: response.total_results\n        });\n        state.updateState({\n            type: 'UPDATE_AREA_COUNT',\n            value: response.area_results ? response.area_results.length : 0\n        });\n\n        render.emptyResults();\n\n        if (state.getState().filter.id && state.getState().count === 0) {\n            console.log(`Display all results for ${state.getState().filter.name}`);\n            fetch(`${state.getState().apiUrl}/search?filter=${state.getState().filter.id}`).then(response => response.json()).then(response => {\n                state.updateState({\n                    type: 'UPDATE_COUNT',\n                    value: response.total_results\n                });\n                state.updateState({\n                    type: 'UPDATE_AREA_COUNT',\n                    value: response.area_results ? response.area_results.length : 0\n                });\n                render.allResultsForAreaType(response.results);\n                bind.areaClick();\n            });\n            return false;\n        }\n\n        render.allResults(response.area_results, response.results);\n        bind.areaClick();\n    }).catch(error => {\n        console.log(`Error getting results data \\n`, error);\n        render.emptyResults();\n        render.error();\n    });\n}\n","import state from './state';\nimport updateResults from './updateResults';\nimport render from './render';\n\nconst inputElem = document.getElementById('search__input');\nconst searchElem = document.getElementById('search');\nconst typeahead = document.getElementById('typeahead');\n\nexport default class bind {\n\n    static areaClick() {\n\n        const areaLinks = document.querySelectorAll('.area-link');\n\n        areaLinks.forEach(link => {\n            link.addEventListener('click', event => {\n                handleClick(event);\n            });\n        });\n\n        function handleClick(event) {\n            event.preventDefault();\n            state.updateState({\n                type: 'UPDATE_FILTER',\n                value: {\n                    id: event.target.getAttribute('data-filter'),\n                    name: event.target.getAttribute('data-filter-name')\n                }\n            });\n            const currentState = state.getState();\n            window.history.pushState({query: currentState.query, filter: currentState.filter.id}, ``, `?q=${currentState.query}&filter=${currentState.filter.id}`);\n            updateResults();\n        }\n    }\n\n    static typeaheadArrowKeys() {\n        searchElem.addEventListener('keypress', (event) => {\n            const keyCode = event.keyCode;\n            const upKey = '38';\n            const downKey = '40';\n\n            if (keyCode !== upKey || keyCode !== downKey) {\n                return;\n            }\n\n            const suggestions = document.getElementsByClass('typeahead__item');\n            let focusIndex = -1; // Default position of no suggestions being focused on\n\n        });\n    }\n\n    static searchFocus() {\n        searchElem.addEventListener('focusout', () => {\n            typeahead.style.display = 'none';\n            render.emptyQuerySuggestions();\n        });\n    }\n\n    static searchSubmit() {\n\n        searchElem.addEventListener('submit', event => {\n            const query = inputElem.value;\n            event.preventDefault();\n            state.updateState({\n                type: 'UPDATE_QUERY',\n                value: query\n            });\n            state.updateState({\n                type: 'UPDATE_FILTER',\n                value: {id: \"\", name: \"\"}\n            });\n\n            if (!query) {\n                window.history.pushState({query: query}, ``, location.pathname);\n                updateResults();\n                return;\n            }\n\n            window.history.pushState({query: query}, ``, `?q=${query}`);\n            updateResults();\n        });\n    }\n\n    static searchChange() {\n        let inputTimer;\n\n        inputElem.addEventListener('input', event => {\n            const inputValue = event.target.value;\n\n            clearTimeout(inputTimer);\n            inputTimer = setTimeout(() => {\n                fetch(`${state.getState().apiUrl}/suggest?q=${inputValue}`).then(response => response.json()).then(response => {\n                    if (response.total_results === 0) {\n                        return;\n                    }\n                    const suggestions = response.results.map(result => {\n                        return result.body.title;\n                    });\n                    render.querySuggestions(suggestions);\n                });\n            }, 100)\n        })\n    }\n\n    static historyState() {\n        window.onpopstate = event => {\n            state.updateState({\n                type: 'UPDATE_QUERY',\n                value: event.state ? event.state.query : ``\n            });\n            updateResults();\n        }\n    }\n}\n","/* Imports */\nimport bind from './bind';\nimport updateResults from './updateResults';\n\n/* Initialise application */\nfunction init() {\n    updateResults();\n    bind.typeaheadArrowKeys();\n    bind.searchFocus();\n    bind.searchChange();\n    bind.searchSubmit();\n    bind.historyState();\n}\n\ninit();\n"],"names":["utilities","hostname","queryString","location","search","queries","split","splice","returnValue","forEach","splitQuery","query","decodeURIComponent","e","error","currentState","getUrlParams","q","filter","state","JSON","parse","stringify","action","newState","getState","log","type","count","value","areaCount","templates","children","id","filterName","name","wrapInContainer","data","title","description","releaseDate","type_id","appElem","document","getElementById","typeahead","render","suggestions","emptyQuerySuggestions","innerHTML","join","style","display","typeaheadArrowKeys","firstChild","removeChild","areaResults","datasetResults","resultsData","HTMLParts","searchText","map","date","result","body","metadata","release_date","pop","push","Date","toLocaleDateString","day","month","year","datasetResultItem","areaSearchText","some","index","areaResultItem","inputElem","updateResults","window","fetch","js","createElement","src","onload","onerror","head","appendChild","apiUrl","then","response","json","updateState","total_results","area_results","length","emptyResults","allResultsForAreaType","results","areaClick","allResults","catch","searchElem","bind","areaLinks","querySelectorAll","addEventListener","event","handleClick","preventDefault","target","getAttribute","history","pushState","keyCode","upKey","downKey","getElementsByClass","focusIndex","pathname","inputTimer","inputValue","setTimeout","querySuggestions","onpopstate","init","searchFocus","searchChange","searchSubmit","historyState"],"mappings":"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"}